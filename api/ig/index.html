<!DOCTYPE html>
<html lang="fr"><head>
  <meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Bienvenue dâ€™Instagram</title>
  <style>
    body{font-family:system-ui,Arial,sans-serif;margin:0;padding:20px;background:#fff;color:#1A1A1A}
    .card{max-width:560px;margin:20px auto;border:1px solid #e6e6e9;border-radius:12px;padding:16px}
    h1{margin:0;text-align:center}
    label{display:block;margin:10px 0}
    input[type="email"]{width:100%;padding:10px;border:1px solid #ddd;border-radius:10px}
    .btn{display:block;width:100%;text-align:center;margin-top:12px;padding:14px;border-radius:12px;border:0;background:#1D3557;color:#fff;font-weight:700}
    .note{background:#f5f7fa;padding:8px;border-radius:8px;margin-top:8px}
  </style>
</head><body>
  <h1>Bienvenue ðŸ‘‹</h1>

  <div class="card">
    <h2>ðŸ“© Restez informÃ©</h2>
    <p>Recevez nos guides et analyses directement par mail.</p>

    <!-- FORMULAIRE NEWSLETTER (Brevo listId=10) -->
    <form id="ig-sub" action="/api/subscribe" method="post" novalidate>
      <label>Email<br>
        <input name="email" type="email" required aria-required="true" autocomplete="email">
      </label>

      <input type="hidden" name="listId" value="10">

      <!-- Consentement RGPD -->
      <label style="display:flex;gap:8px;align-items:flex-start;margin:10px 0">
        <input type="checkbox" name="consent" required aria-required="true">
        <span>Jâ€™accepte de recevoir des emails. Jâ€™ai lu la
          <a href="/politique-confidentialite" target="_blank" rel="noopener">politique de confidentialitÃ©</a>.
        </span>
      </label>

      <!-- BOUTON Sâ€™ABONNER -->
      <button class="btn" type="submit">Sâ€™abonner</button>
      <p id="ig-sub-msg" class="note" role="status"></p>
    </form>
  </div>

  <script>
    // Envoi du formulaire (affiche un message sous le bouton)
    document.getElementById('ig-sub').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const msg = document.getElementById('ig-sub-msg');
      msg.textContent = 'Envoi en coursâ€¦';
      const fd = new FormData(e.target), body = Object.fromEntries(fd.entries());
      try{
        const r = await fetch('/api/subscribe',{
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify(body)
        });
        if(r.ok){ msg.textContent = 'Merci ! VÃ©rifiez votre email pour confirmer.'; e.target.reset(); }
        else{ msg.textContent = 'Impossible de traiter votre demande.'; }
      }catch(err){ msg.textContent = 'Erreur rÃ©seau. RÃ©essayez.'; }
    });
  </script>
</body></html>
